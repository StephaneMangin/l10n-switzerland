<?xml version="1.0" encoding="UTF-8"?>
<XML-FSCM-INVOICE-2013A>
  <INTERCHANGE>
    <IC-SENDER>
      <Pid>pid_bill_sender</Pid>
    </IC-SENDER>
    <IC-RECEIVER>
      <Pid>41010106799303734</Pid>
    </IC-RECEIVER>
    <IC-Ref>$IC_REF</IC-Ref>
  </INTERCHANGE>
  <INVOICE Type="EFD">
    <HEADER>
      <FUNCTION-FLAGS>
        <Confirmation-Flag />
      </FUNCTION-FLAGS>
      <MESSAGE-REFERENCE>
        <REFERENCE-DATE>
          <Reference-No>INV_TEST_01</Reference-No>
          <Date>20190607</Date>
        </REFERENCE-DATE>
      </MESSAGE-REFERENCE>
      <PRINT-DATE>
        <Date>20190607</Date>
      </PRINT-DATE>
      <REFERENCE>
        <INVOICE-REFERENCE>
          <REFERENCE-DATE>
            <Reference-No>INV_TEST_01</Reference-No>
            <Date>20190607</Date>
          </REFERENCE-DATE>
        </INVOICE-REFERENCE>
      </REFERENCE>
      <BILLER>
        <Tax-No>CHE-012.345.678</Tax-No>
        <Doc-Reference>ref esr</Doc-Reference>
        <PARTY-ID>
          <Pid>pid_bill_sender</Pid>
        </PARTY-ID>
        <NAME-ADDRESS Format="COM">
          <NAME>
            <Line-35>TestCompany</Line-35>
          </NAME>
          <STREET>
            <Line-35>StreetOne</Line-35>
          </STREET>
          <City>TestCity</City>
          <Zip>8888</Zip>
          <Country>CH</Country>
        </NAME-ADDRESS>
        <BANK-INFO>
          <Acct-No>300300300</Acct-No>
          <Acct-Name>AccountHolderName</Acct-Name>
          <BankId Type="BCNr-int" Country="CH">001996</BankId>
        </BANK-INFO>
      </BILLER>
      <PAYER>
        <PARTY-ID>
          <Pid>123123123</Pid>
        </PARTY-ID>
        <NAME-ADDRESS Format="PRV">
          <NAME>
            <Line-35>Customer One</Line-35>
          </NAME>
          <STREET>
            <Line-35>Rue des îles à rêves, 23</Line-35>
            <Line-35>Passage des araignées</Line-35>
          </STREET>
          <City>Lausanne</City>
          <Zip>1202</Zip>
          <Country>CH</Country>
        </NAME-ADDRESS>
      </PAYER>
    </HEADER>
    <LINE-ITEM />
    <SUMMARY>
      <INVOICE-AMOUNT>
        <Amount Currency="CHF">{{ invoice.amount_total }}</Amount>
      </INVOICE-AMOUNT>
      <VAT-AMOUNT>
        <Amount Currency="CHF">{{ invoice.amount_tax }}</Amount>
      </VAT-AMOUNT>
      <EXTENDED-AMOUNT Type="79">
        <Amount Currency="CHF">{{ invoice.amount_untaxed }}</Amount>
      </EXTENDED-AMOUNT>
      {% if invoice.tax_line %}
      {% for taxline in invoice.tax_line %}
      <TAX>
        <TAX-BASIS>
          <Amount Currency="CHF">{{ taxline.base }}</Amount>
        </TAX-BASIS>
        {# Naive implementation. #}
        {# Openerp groups lines by base code, tax code and account, so in #}
        {# general we might have different tax rates per taxline. #}
      {% if taxline.base %}
      <Rate Category="S">{{ round(taxline.amount / taxline.base * 100, 2) }}</Rate>
      {% else %}
      <Rate Category="E">0</Rate>
      {% endif %}
      <Amount Currency="CHF">{{ taxline.amount }}</Amount>
    </TAX>
    {% endfor %}
    {% else %}
    <TAX>
      <TAX-BASIS>
        <Amount Currency="CHF">{{ invoice.amount_untaxed }}</Amount>
      </TAX-BASIS>
      <Rate Category="E">0</Rate>
      <Amount Currency="CHF">0</Amount>
    </TAX>
    {% endif %}
    <PAYMENT-TERMS>
      <BASIC Payment-Type="{{ payment_type }}" Terms-Type="5">
        <TERMS>
          <Date>{{ format_date(invoice.date_due or invoice.date_invoice) }}</Date>
        </TERMS>
      </BASIC>
    </PAYMENT-TERMS>
    <Back-Pack-Container Encode="Base64">
      {{ pdf_data }}
    </Back-Pack-Container>
  </SUMMARY>
</INVOICE>
</XML-FSCM-INVOICE-2013A>

